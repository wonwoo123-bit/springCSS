<th:block th:insert="~{modules/header}"></th:block>

<!-- Content Wrapper. Contains page content -->
<div>
    <section class="content-header">
        <div class="container-fluid">
            <div class="row md-2">
                <div class="col-sm-6">
                    <h1>수정페이지</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="#"> <i class="fa fa-dashboard">회원관리</i>
                            </a></li>
                        <li class="breadcrumb-item active">수정</li>
                    </ol>
                </div>
            </div>
        </div>
    </section>
    <!-- Main content -->
    <section class="content register-page">
        <form role="form" class="form-horizontal" action="modify" method="post" enctype="multipart/form-data">
            <div class="card" style="min-width: 450px;">
                <div class="card-body">
                    <div class="row">
                        <input type="hidden" name="oldPicture" th:value="${member.picture}"/>
                        <div class="input-group col-md-12">
                            <div class="col-md-12" style="text-align: center;">
                                <div id="pictureView" class="manPicture" th:data-id="${member.id}"
                                    style="border: 1px solid green; height: 200px; width: 140px; margin: 0 auto; margin-bottom: 5px;">
                                </div>
                                <div class="input-group input-group-sm">
                                    <label for="inputFile"
                                        class=" btn btn-warning btn-sm btn-flat input-group-addon">사진변경</label>
                                    <input id="inputFileName" class="form-control" type="text" name="tempPicture"
                                        disabled th:value="${#strings.setSplit(member.picture,'\\$\\$')[1]}" />
                                    <input type="file" id="inputFile" name="picture" style="display: none"
                                        onchange="picture_go();" />
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-3 control-label text-right">아이디</label>

                        <div class="col-sm-9">
                            <input name="id" type="text" class="form-control" id="inputEmail3" th:value="${member.id}">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputPassword3" class="col-sm-3 control-label text-right">패스워드</label>

                        <div class="col-sm-9">
                            <input name="pwd" type="password" class="form-control" id="inputPassword3" th:value="${member.pwd}">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="inputPassword3" class="col-sm-3 control-label text-right">이 름</label>

                        <div class="col-sm-9">
                            <input name="name" type="text" class="form-control" id="inputPassword3" th:value="${member.name}">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputPassword3" class="col-sm-3 control-label text-right">주 소</label>

                        <div class="col-sm-9">
                            <input name="address" type="text" class="form-control" id="inputPassword3" th:value="${member.address}">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputPassword3" class="col-sm-3 control-label text-right">권 한</label>

                        <div class="col-sm-9 ">
                            <div class="row">
                                <div class="custom-control custom-radio">
                                    <input name="authorities" type="radio" class="custom-control-input" id="ROLE_USER" th:checked="${member.authorities == 'ROLE_USER'}">
                                    <label for="ROLE_USER" class="custom-control-label">사용자</label>
                                </div>
                                &nbsp;&nbsp; &nbsp;&nbsp;
                                <div class="custom-control custom-radio">
                                    <input name="authorities" type="radio" class="custom-control-input"
                                        id="ROLE_MANAGER" th:checked="${member.authorities == 'ROLE_MANAGER'}">
                                    <label for="ROLE_MANAGER" class="custom-control-label">운영자</label>
                                </div>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <div class="custom-control custom-radio">
                                    <input name="authorities" type="radio" class="custom-control-input" id="ROLE_ADMIN" th:checked="${member.authorities == 'ROLE_ADMIN'}">
                                    <label for="ROLE_ADMIN" class="custom-control-label">관리자</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="inputPassword3" class="col-sm-3 control-label text-right">이메일</label>

                        <div class="col-sm-9">
                            <input name="email" type="email" class="form-control"
                                id="inputPassword3" th:value="${member.email}">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputPassword3" class="col-sm-3 control-label text-right">전화번호</label>
                        <div class="col-sm-9">
                            <input name="phone"  type="text" class="form-control" id="inputPassword3" th:value="${member.phone}">
                        </div>
                    </div>
                    <div class="card-footer row" style="margin-top: 0; border-top: none;">
                        <button type="button" id="modifyBtn" onclick="modify_go();"
                            class="btn btn-warning col-sm-4 text-center">수정하기</button>
                        <div class="col-sm-4"></div>
                        <button type="button" id="cancelBtn" onclick="history.go(-1);"
                            class="btn btn-default pull-right col-sm-4 text-center">취
                            소</button>
                    </div>
                </div>
            </div>
        </form>
    </section>
    <!-- /.content -->
</div>

<th:block th:insert="~{modules/common_js}"></th:block>
<script>
   MemberPictureThumb('[[@{/}]]');

   function picture_go() {
        // alert("click picture btn");
        let pictureInput = document.querySelector("input[name='picture']");
        let file = pictureInput.files[0];

        //이미지 확장자 jpg 확인
        var fileFormat = file.name.substr(file.name.lastIndexOf(".") + 1).toUpperCase();
        if (!(fileFormat == "JPG" || fileFormat == "JPEG")) {
            alert("이미지는 jpg/jpeg 형식만 가능합니다.");
            pictureInput.value = "";
            return;
        }

        //이미지 파일 용량 체크
        if (file.size > 1024 * 1024 * 1) {
            alert("사진 용량은 1MB 이하만 가능합니다.");
            pictureInput.value = "";
            return;
        };

        document.querySelector('#inputFileName').value = file.name;

        document.querySelector('#inputFileName').value = file.name;
        if (file) {
            var reader = new FileReader();

            reader.onload = function (e) {
                //이미지 미리보기	        	
                pictureView.style.backgroundImage = "url(" + e.target.result + ")";
                pictureView.style.backgroundPosition = "center";
                pictureView.style.backgroundSize = "cover";
                pictureView.style.backgroundRepeat = "no-repeat";
            }

            reader.readAsDataURL(file);
        }
    }

     function modify_go(){
       var form = $('form[role="form"]');
       form.submit();
    }
</script>

<th:block th:insert="~{modules/footer}"></th:block>